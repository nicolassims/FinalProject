(this.webpackJsonpfinal_project=this.webpackJsonpfinal_project||[]).push([[0],{138:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),o=n(16),c=n.n(o),a=(n(65),n(142)),i=n(7),u=(n(66),n(17)),l=n(144),d=n(140),j=n(141),h=n(57),b=n(143),f=n(145),p=n(15),O=n(10),x=n(18),v=n.n(x),m=n(34),g=n(22);function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"users/set":return t.data;default:return e}}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"monsters/set":return t.data;default:return e}}function k(e){localStorage.setItem("twitter",JSON.stringify(e))}function S(){var e=localStorage.getItem("twitter");return e?e=JSON.parse(e):null}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"twitter/set":return k(t.data),t.data;case"session/clear":return localStorage.removeItem("twitter"),null;default:return e}}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"user_form/set":return t.data;default:return e}}function N(e){var t=Object.assign({},e,{time:Date.now()});localStorage.setItem("session",JSON.stringify(t))}function M(){var e=localStorage.getItem("session");if(!e)return null;e=JSON.parse(e);return Date.now()-e.time<864e5?e:null}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"session/set":return N(t.data),t.data;case"session/clear":return localStorage.removeItem("session"),null;default:return e}}function J(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"error/clear":case"session/set":return null;case"error/set":return t.data;default:return e}}var _=Object(g.c)((function(e,t){return Object(g.b)({users:w,user_form:T,monsters:y,session:D,error:J,twitter:C})(e,t)})),I=n(56),L=null,F=null,P=null,A=null;function U(e){var t=e.users;P(t)}function B(e){var t=e.monsters;A(t)}function R(e){(L=new I.Socket("ws://localhost:4000/socket",{params:{token:e.token}})).connect(),(F=L.channel("game",{token:e.token})).on("update",U),F.on("updatemonsters",B),F.join().receive("ok",(function(e){console.log("Authorized",e)})).receive("error",(function(e){console.log("Unable to join",e)}))}function G(e){var t,n=_.getState(),r=null===n||void 0===n||null===(t=n.session)||void 0===t?void 0:t.token;return e.headers?e.headers["x-auth"]=r:e.headers={"x-auth":r},e}function W(){z("/twitter").then((function(e){console.log("TWITTER AUTH PART 1"),console.log(e),_.dispatch({type:"twitter/set",data:e})}))}function z(e){return E.apply(this,arguments)}function E(){return(E=Object(m.a)(v.a.mark((function e(t){var n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:4000/api/v1"+t,G({}));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return q.apply(this,arguments)}function q(){return(q=Object(m.a)(v.a.mark((function e(t,n){var r,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},console.log(r),e.next=4,fetch("http://localhost:4000/api/v1"+t,G(r));case 4:return s=e.sent,e.next=7,s.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return K.apply(this,arguments)}function K(){return(K=Object(m.a)(v.a.mark((function e(t,n){var r,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},console.log(r),e.next=4,fetch("http://localhost:4000/api/v1"+t,G(r));case 4:return s=e.sent,e.next=7,s.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){z("/users").then((function(e){return _.dispatch({type:"users/set",data:e})}))}function V(e){return $("/users/"+e.id,{user:e})}function X(e){return $("/monsters/"+e.id,{monster:e})}var Y=n(1);function Z(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),n=t[0],s=t[1],o=Object(r.useState)(""),c=Object(u.a)(o,2),a=c[0],i=c[1];return Object(Y.jsxs)(l.a,{onSubmit:function(e){e.preventDefault(),function(e,t){H("/session",{name:e,password:t}).then((function(e){if(e.session){var t={type:"session/set",data:e.session};_.dispatch(t)}else if(e.error){var n={type:"error/set",data:e.error};_.dispatch(n)}e.session&&(R(e.session),W())}))}(n,a)},inline:!0,children:[Object(Y.jsx)(l.a.Control,{name:"name",type:"text",onChange:function(e){return s(e.target.value)},value:n}),Object(Y.jsx)(l.a.Control,{name:"password",type:"password",onChange:function(e){return i(e.target.value)},value:a}),Object(Y.jsx)(d.a,{variant:"primary",type:"submit",children:"Login"})]})}function ee(e){var t=e.session;return Object(Y.jsxs)("p",{children:["Logged in as ",t.name,Object(Y.jsx)(d.a,{onClick:function(e){e.preventDefault(),_.dispatch({type:"session/clear"}),F&&F.leave(),F=null,console.log("Disconnecting")},children:"Logout"})]})}var te=Object(O.b)((function(e){return{session:e.session,twitter:e.twitter}}))((function(e){var t=e.session;return t?Object(Y.jsx)("div",{children:Object(Y.jsx)(ee,{session:t})}):Object(Y.jsx)(Z,{})}));function ne(e){var t=e.to,n=e.children;return Object(Y.jsx)(f.a.Item,{children:Object(Y.jsx)(p.c,{to:t,exact:!0,onClick:function(){_.dispatch({type:"error/clear",data:null})},className:"nav-link",activeClassName:"active",children:n})})}var re=Object(O.b)((function(e){return{error:e.error,twitter:e.twitter}}))((function(e){var t=e.error,n=e.twitter,r=null;return t&&(r=Object(Y.jsx)(j.a,{children:Object(Y.jsx)(h.a,{children:Object(Y.jsx)(b.a,{variant:"danger",children:t})})})),Object(Y.jsxs)("div",{children:[Object(Y.jsxs)(j.a,{children:[Object(Y.jsx)(h.a,{children:Object(Y.jsxs)(f.a,{variant:"pills",children:[Object(Y.jsx)(ne,{to:"/",children:"Feed"}),Object(Y.jsx)(ne,{to:"/users",children:"Users"})]})}),Object(Y.jsx)(h.a,{children:Object(Y.jsx)(d.a,{href:null===n||void 0===n?void 0:n.url,children:"Authorize Twitter"})}),Object(Y.jsx)(h.a,{children:Object(Y.jsx)(te,{})})]}),r]})})),se=n(146);function oe(e,t){var n=e.reduce((function(e,n){return n.user.id===t.id?e+1:e}),0),r=Math.pow(10,n)-1;if(t.food>=r){var s=["Dragon","Medusa","Pikachu","Werewolf","Jerry","Creeper","Ghost","Demon","Mimic","Ooze","Skeleton"],o=["Draco","Dusa","Sparky","Howler","Jerry","Ssboom","Boo","Satanael","Doopliss","Rimuru","Sans"],c={name:s[Math.floor(Math.random()*s.length)],nickname:o[Math.floor(Math.random()*o.length)],power:1,location:0,user_id:t.id};t.food-=r,V(t),function(e){H("/monsters",{monster:e})}(c)}}function ce(e){var t=e.monster,n=0===t.location?"The Farm":"The Wild";return Object(Y.jsx)(h.a,{children:Object(Y.jsxs)(se.a,{className:"card",children:[Object(Y.jsx)(se.a.Title,{title:"Click to rename monster!",className:"cardbody nickname",onClick:function(){return function(e){var t=prompt("What would you like to nickname this "+e.name+"?");null!=t&&(e.nickname=t,X(e))}(t)},children:t.nickname}),Object(Y.jsxs)(se.a.Text,{className:"cardbody",children:["Species: ",t.name,Object(Y.jsx)("br",{}),"Power: ",t.power,Object(Y.jsx)("br",{}),"Location: ",n,Object(Y.jsx)("br",{})]}),Object(Y.jsx)(d.a,{onClick:function(){return function(e){0===e.location?e.location=1:e.location=0,X(e)}(t)},children:"Switch Location"}),Object(Y.jsx)(d.a,{onClick:function(){return function(e){var t=Math.round(e.user.food/10);e.user.food-=t,e.power+=t,V(e.user),X(e)}(t)},children:"Feed Monster"})]})})}function ae(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),n=t[0],s=t[1];return Object(Y.jsx)(j.a,{children:Object(Y.jsxs)(l.a,{onSubmit:function(e){e.preventDefault(),function(e){return H("/twitter",{tweet:e})}(""===n?"Join me in Monster Browser! Feed my monsters by liking this tweet!":n).then((function(e){e.error?alert("Sorry, we've encountered an error while attempting to send your tweet. Try again?"):alert("Tweet sent!")}))},inline:!0,children:[Object(Y.jsx)(l.a.Control,{name:"tweet",className:"longbox",type:"text",onChange:function(e){return s(e.target.value)},placeholder:"Join me in Monster Browser! Feed my monsters by liking this tweet!",value:n}),Object(Y.jsx)(d.a,{variant:"primary",type:"submit",children:"Tweet"})]})})}var ie=Object(O.b)((function(e){return{monsters:e.monsters,users:e.users}}))((function(e){var t=e.monsters,n=e.users,r=JSON.parse(localStorage.getItem("session")),s=null,o=0,c=0;if(null!=r&&0!==n.length){s=t.sort((function(e,t){return e.power<t.power?1:-1})).reduce((function(e,t){return t.user.id===r.user_id&&(e.push(Object(Y.jsx)(ce,{monster:t},t.id)),o+=Math.round(Math.sqrt(t.power)),c++),e}),[]);var a=n.find((function(e){return e.id===r.user_id})),i=Math.pow(10,c)-1,u=Object(Y.jsxs)("h5",{children:[i-a.food," until your next monster!"]});return a.food>=i&&(u=Object(Y.jsx)(d.a,{onClick:function(){return oe(t,a)},children:"Buy new monster!"})),Object(Y.jsxs)("div",{children:[Object(Y.jsx)(ae,{}),Object(Y.jsx)(j.a,{children:Object(Y.jsxs)("h1",{children:["Food: ",a.food]})}),Object(Y.jsx)(j.a,{children:Object(Y.jsxs)("h4",{children:["Max food per second: ",o]})}),Object(Y.jsx)(j.a,{children:s}),Object(Y.jsx)(j.a,{children:Object(Y.jsx)(h.a,{children:u})})]})}return Object(Y.jsx)("h1",{children:"Log into the game to access your homepage!"})}));var ue=Object(O.b)((function(e){return{users:e.users}}))((function(e){var t=e.users.sort((function(e,t){return e.food<t.food?1:-1})).map((function(e){return Object(Y.jsxs)("tr",{children:[Object(Y.jsx)("td",{children:e.name}),Object(Y.jsx)("td",{children:e.food})]},e.id)}));return Object(Y.jsx)("div",{children:Object(Y.jsx)(j.a,{children:Object(Y.jsxs)(h.a,{children:[Object(Y.jsx)("h2",{children:"List Users"}),Object(Y.jsx)("p",{children:Object(Y.jsx)(p.b,{to:"/users/new",children:"New User"})}),Object(Y.jsxs)("table",{className:"table table-striped",children:[Object(Y.jsx)("thead",{children:Object(Y.jsxs)("tr",{children:[Object(Y.jsx)("th",{children:"Name"}),Object(Y.jsx)("th",{children:"Food"})]})}),Object(Y.jsx)("tbody",{children:t})]})]})})})})),le=n(60),de=n.n(le);var je=Object(O.b)((function(e){return{error:e.error}}))((function(e){e.error;var t=Object(i.f)(),n=Object(r.useState)({name:"",pass1:"",pass2:""}),s=Object(u.a)(n,2),o=s[0],c=s[1];function a(e,t){var n,r,s=Object.assign({},o);s[e]=t.target.value,s.password=s.pass1,s.pass_msg=(n=s.pass1,r=s.pass2,n!==r?"Passwords don't match.":n.length<8?"Password too short.":""),c(s)}return Object(Y.jsx)("div",{children:Object(Y.jsx)(j.a,{children:Object(Y.jsxs)(h.a,{children:[Object(Y.jsx)("h2",{children:"New User"}),Object(Y.jsxs)(l.a,{onSubmit:function(e){e.preventDefault(),function(e){return H("/users",{user:e})}(de()(o,["name","password"])).then((function(e){e.error?_.dispatch({type:"error/set",data:e.error}):(Q(),t.push("/users"))}))},children:[Object(Y.jsxs)(l.a.Group,{children:[Object(Y.jsx)(l.a.Label,{children:"Name"}),Object(Y.jsx)(l.a.Control,{type:"text",onChange:function(e){return a("name",e)},value:o.name||""})]}),Object(Y.jsxs)(l.a.Group,{children:[Object(Y.jsx)(l.a.Label,{children:"Password"}),Object(Y.jsx)(l.a.Control,{type:"password",onChange:function(e){return a("pass1",e)},value:o.pass1||""}),Object(Y.jsx)("p",{children:o.pass_msg})]}),Object(Y.jsxs)(l.a.Group,{children:[Object(Y.jsx)(l.a.Label,{children:"Confirm Password"}),Object(Y.jsx)(l.a.Control,{type:"password",onChange:function(e){return a("pass2",e)},value:o.pass2||""})]}),Object(Y.jsx)(d.a,{variant:"primary",type:"submit",disabled:""!==o.pass_msg,children:"Save"})]})]})})})}));function he(e,t){var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var be=Object(O.b)((function(e){return{twitter:e.twitter}}))((function(e){var t=e.twitter,n=Object(i.g)().search;console.log(n);var r=he("oauth_token",n);console.log(r);var s=he("oauth_verifier",n);return console.log(s),console.log(t.req_token),H("/twitter",{verifier:s,token:r}).then((function(e){console.log(e),e.error?alert("Authentication seems to have failed. Try again?"):alert("Authentication succeeded!")})),Object(i.f)().push("/"),Object(Y.jsx)("div",{})}));var fe=Object(O.b)((function(e){return{session:e.session}}))((function(e){var t=e.session;return P=function(e){_.dispatch({type:"users/set",data:e})},function(e){A=e}((function(e){_.dispatch({type:"monsters/set",data:e})})),t&&(R(t),W()),Object(Y.jsxs)(a.a,{children:[Object(Y.jsx)(re,{}),Object(Y.jsxs)(i.c,{children:[Object(Y.jsx)(i.a,{path:"/",exact:!0,children:Object(Y.jsx)(ie,{})}),Object(Y.jsx)(i.a,{path:"/users",exact:!0,children:Object(Y.jsx)(ue,{})}),Object(Y.jsx)(i.a,{path:"/users/new",children:Object(Y.jsx)(je,{})}),Object(Y.jsx)(i.a,{path:"/auth/twitter",children:Object(Y.jsx)(be,{})})]})]})})),pe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,147)).then((function(t){var n=t.getCLS,r=t.getFID,s=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),r(e),s(e),o(e),c(e)}))};c.a.render(Object(Y.jsx)(s.a.StrictMode,{children:Object(Y.jsx)(O.a,{store:_,children:Object(Y.jsx)(p.a,{children:Object(Y.jsx)(fe,{})})})}),document.getElementById("root")),Q(),z("/monsters").then((function(e){return _.dispatch({type:"monsters/set",data:e})})),pe()},65:function(e,t,n){},66:function(e,t,n){}},[[138,1,2]]]);
//# sourceMappingURL=main.a9850760.chunk.js.map